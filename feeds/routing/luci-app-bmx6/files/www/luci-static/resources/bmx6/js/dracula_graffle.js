Raphael.fn.connection=function(n,p,f){var m=this,k={draw:function(){for(var a=n.getBBox(),e=p.getBBox(),b=[{x:a.x+a.width/2,y:a.y-0},{x:a.x+a.width/2,y:a.y+a.height+0},{x:a.x-0,y:a.y+a.height/2},{x:a.x+a.width+0,y:a.y+a.height/2},{x:e.x+e.width/2,y:e.y-0},{x:e.x+e.width/2,y:e.y+e.height+0},{x:e.x-0,y:e.y+e.height/2},{x:e.x+e.width+0,y:e.y+e.height/2}],e={},g=[],c=0;4>c;c++)for(var d=4;8>d;d++){var h=Math.abs(b[c].x-b[d].x),a=Math.abs(b[c].y-b[d].y);if(c==d-4||(3!=c&&6!=d||b[c].x<b[d].x)&&(2!=c&&7!=
d||b[c].x>b[d].x)&&(0!=c&&5!=d||b[c].y>b[d].y)&&(1!=c&&4!=d||b[c].y<b[d].y))g.push(h+a),e[g[g.length-1].toFixed(3)]=[c,d]}var d=0==g.length?[0,4]:e[Math.min.apply(Math,g).toFixed(3)],e=b[d[0]].x,g=b[d[0]].y,c=b[d[1]].x,b=b[d[1]].y,h=Math.max(Math.abs(e-c)/2,10),a=Math.max(Math.abs(g-b)/2,10),l=[e,e,e-h,e+h][d[0]].toFixed(3),q=[g-a,g+a,g,g][d[0]].toFixed(3),h=[0,0,0,0,c,c,c-h,c+h][d[1]].toFixed(3),a=[0,0,0,0,g+a,g-a,b,b][d[1]].toFixed(3),d=["M",e.toFixed(3),g.toFixed(3),"C",l,q,h,a,c.toFixed(3),b.toFixed(3)].join();
f&&f.directed&&(l=Math.sqrt((b-a)*(b-a)+(c-h)*(c-h)),a=[{x:(5*-(c-h)/l+5*-(b-a)/l+c).toFixed(3),y:(5*-(b-a)/l+5*-(c-h)/l+b).toFixed(3)},{x:(5*-(c-h)/l-5*-(b-a)/l+c).toFixed(3),y:(5*-(b-a)/l-5*-(c-h)/l+b).toFixed(3)}],d=d+",M"+a[0].x+","+a[0].y+",L"+c+","+b+",L"+a[1].x+","+a[1].y);k.fg&&k.fg.attr({path:d})||(k.fg=m.path(d).attr({stroke:f&&f.stroke||"#000",fill:"none"}).toBack());k.bg&&k.bg.attr({path:d})||f&&f.fill&&(k.bg=f.fill.split&&m.path(d).attr({stroke:f.fill.split("|")[0],fill:"none","stroke-width":f.fill.split("|")[1]||
3}).toBack());f&&f.label&&(k.label&&k.label.attr({x:(e+c)/2,y:(g+b)/2})||(k.label=m.text((e+c)/2,(g+b)/2,f.label).attr({fill:"#000","font-size":f["font-size"]||"12px"})));f&&f.label&&f["label-style"]&&k.label&&k.label.attr(f["label-style"]);f&&f.callback&&f.callback(k)}};k.draw();return k};
